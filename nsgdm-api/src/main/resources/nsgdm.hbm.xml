<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD 3.0//EN" "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd">
<!-- Document : nsdm.hbm.xml Created on : 26 November 2012, 16:59 Author 
	: a.benabdelkader@amc.uva.nl Description: Purpose of the document follows. -->
<hibernate-mapping default-access="field"
	default-cascade="all" package="nl.amc.biolab.nsgdm">

	<!-- ************** Class PROJECT *************** -->
	<class name="Project" table="Project">
		<id column="ProjectID" name="dbId" type="long">
			<generator class="native" />
		</id>
		<property column="XnatID" name="XnatID" type="string" />
		<property column="ProjectName" name="ProjectName" type="string" />
		<property column="ProjectDescription" name="ProjectDescription"
			type="string" length="512" />
		<property column="ProjectOwner" name="ProjectOwner" type="string" />
		<bag lazy="false" name="processings" inverse="true">
			<key column="ProjectID" />
			<one-to-many class="Processing" />
		</bag>
		<bag lazy="false" name="ProjectData" table="ProjectData" inverse="true">
			<key column="ProjectID" />
			<many-to-many class="DataElement" column="DataID" />
		</bag>
		<bag lazy="false" name="ProjectApplication" table="ProjectApplication"
			inverse="true">
			<key column="ProjectID" />
			<many-to-many class="Application" column="ApplicationID" />
		</bag>
		<bag lazy="false" name="users" table="UserProject">
			<key column="ProjectID" />
			<many-to-many class="User" column="UserKey" />
		</bag>
	</class>

	<!-- ************** Class APPLICATION *************** -->
	<class name="Application" table="Application">
		<id column="ApplicationID" name="dbId" type="long">
			<generator class="native" />
		</id>
		<property column="Name" name="Name" type="string" />
		<property column="Description" name="Description" type="string" />
		<property column="Version" name="Version" type="string" />
		<property column="ReleaseDate" name="ReleaseDate" type="string" />
		<property column="OS" name="OS" type="string" />
		<property column="Platform" name="Platform" type="string" />
		<property column="Executable" name="Executable" type="string" />
		<property column="Developers" name="Developers" type="string" />
		<property column="InternalName" name="InternalName" type="string" />
		<property column="Type" name="Type" type="int" />
		<bag lazy="false" name="processings" inverse="true">
			<key column="ApplicationID" />
			<one-to-many class="Processing" />
		</bag>
		<bag lazy="false" name="ApplicationProjects" table="ProjectApplication">
			<key column="ApplicationID" />
			<many-to-many class="Project" column="ProjectID" />
		</bag>
		<bag lazy="false" name="users" table="UserApplication">
			<key column="ApplicationID" />
			<many-to-many class="User" column="UserKey" />
		</bag>
		<bag lazy="false" name="ioports" inverse="true">
			<key column="ApplicationID" />
			<one-to-many class="IOPort" />
		</bag>
	</class>

	<!-- ************** Class PROPERTY *************** -->
	<class name="Property" table="Property">
		<id column="PropertyID" name="dbId" type="long">
			<generator class="native" />
		</id>
		<property column="PropertyKey" name="key" />
		<property column="PropertyValue" length="1024" name="value" />
		<property column="PropertyDesc" name="description" type="string" />
		<property column="DCid" name="dcid" type="int" />
	</class>

	<!-- ************** Class UserProcessing *************** -->
	<class name="UserProcessing" table="UserProcessing">
		<id column="dbId" name="dbId" type="long">
			<generator class="native" />
		</id>
		<property column="ACL" name="acl" type="boolean" />
		<many-to-one name="user" class="User" column="UserKey"  not-null="true"/>
		<many-to-one name="processing" class="Processing" column="ProcessingID"  not-null="true"/>
	</class>



	<!-- ************** Class RESOURCE *************** -->
	<class name="Resource" table="Resource">
		<id column="ResourceID" name="dbId" type="long">
			<generator class="native" />
		</id>
		<property column="Name" name="Name" type="string" />
		<property column="Description" name="Description" type="string" />
		<property column="BaseURI" name="BaseURI" type="string" />
		<property column="Storage" name="storage" type="boolean" />
		<property column="Computing" name="computing" type="boolean" />
		<property column="Robot" name="robot" type="boolean" />
		<property column="Protocol" name="protocol" type="string" />
		<bag lazy="false" name="data" inverse="true">
			<key column="ResourceID" />
			<one-to-many class="DataElement" />
		</bag>
		<bag lazy="false" name="replicas" inverse="true">
			<key column="ResourceID" />
			<one-to-many class="Replica" />
		</bag>
		<bag lazy="false" name="ports" inverse="true">
			<key column="ResourceID" />
			<one-to-many class="IOPort" />
		</bag>
	</class>

	<!-- ************** Class DATA ELEMENT *************** -->
	<class name="DataElement" table="DataElement">
		<id column="DataID" name="dbId" type="long">
			<generator class="native" />
		</id>
		<property column="Name" name="Name" type="string" />
		<property column="ScanID" name="ScanID" type="string" />
		<property column="URI" name="URI" type="string" />
		<property column="Subject" name="Subject" type="string" />
		<property column="Type" name="Type" type="string" />
		<property column="Format" name="Format" type="string" />
		<property column="Date" name="Date" type="timestamp" />
		<property column="Size" name="Size" type="int" />
		<property column="Applications" name="Applications" type="string" />
		<bag lazy="false" name="properties">
			<key column="DataID" />
			<one-to-many class="Property" />
		</bag>
		<bag lazy="false" name="projects" table="ProjectData">
			<key column="DataID" />
			<many-to-many class="Project" column="ProjectID" />
		</bag>
		<!--bag lazy="false" name="processings" inverse="true">
			<key column="ApplicationID" />
			<one-to-many class="Processing" />
		</bag-->
		<bag lazy="false" name="submissionIOs" inverse="true">
			<key column="DataID" />
			<one-to-many class="SubmissionIO" />
		</bag>
		<many-to-one name="resource" class="Resource" column="ResourceID"  not-null="true"/>
		<bag lazy="false" name="replicas" inverse="true">
			<key column="DataID" />
			<one-to-many class="Replica" />
		</bag>
	</class>

	<!-- ************** Class Processing *************** -->
	<class name="Processing" table="Processing">
		<id column="ProcessingID" name="dbId" type="long">
			<generator class="native" />
		</id>
		<property column="ProcessingName" name="ProcessingName" type="string" />
		<property column="ProcessingDescription" name="ProcessingDescription"/>
		<property column="ProcessingDate" name="ProcessingDate" type="timestamp" />
		<property column="ProcessingStatus" name="ProcessingStatus"	type="string" lazy="false"/>
		<!--property column="Developers" name="Developers"	type="string" /-->
		<property column="ProcessingLastUpdate" name="ProcessingLastUpdate"	type="timestamp"/>
		<many-to-one name="application" class="Application" column="ApplicationID"  not-null="true"/>
		<many-to-one name="project" class="Project" column="ProjectID"  not-null="true"/>
		<bag lazy="false" name="users" table="UserProcessing">
			<key column="ProcessingID" />
			<many-to-many class="User" column="UserKey" />
		</bag>
		<bag lazy="false" name="acls" inverse="true">
			<key column="ProcessingID" />
			<one-to-many class="UserProcessing" />
		</bag>
		<bag lazy="false" name="submissions" inverse="true">
			<key column="ProcessingID" />
			<one-to-many class="Submission" />
		</bag>
	</class>

	<!-- ************** Class SUBMISSION *************** -->
	<class name="Submission" table="Submission">
		<id column="SubmissionID" name="dbId" type="long">
			<generator class="native" />
		</id>
		<property column="Name" name="Name" type="string" />
		<property column="Status" name="status" type="string" />
		<property column="Results" name="results" type="boolean" />
		<many-to-one name="processing" class="Processing" column="ProcessingID"  not-null="true"/>
		<bag lazy="false" name="statuses" inverse="true">
			<key column="SubmissionID" />
			<one-to-many class="Status" />
		</bag>
		<bag lazy="false" name="submissionIOs" inverse="true">
			<key column="SubmissionID" />
			<one-to-many class="SubmissionIO" />
		</bag>
		<bag lazy="false" name="errors" inverse="true">
			<key column="SubmissionID" />
			<one-to-many class="Error" />
		</bag>
	</class>

	<!-- ************** Class SubmissionIO *************** -->
	<class name="SubmissionIO" table="SubmissionIO">
		<id column="dbId" name="dbId" type="long">
			<generator class="native" />
		</id>
		<property column="Type" name="Type" type="string" />
		<many-to-one name="dataelement" class="DataElement" column="DataID"  not-null="true"/>
		<many-to-one name="submission" class="Submission" column="SubmissionID"  not-null="true"/>
		<many-to-one name="ioport" class="IOPort" column="PortID"  not-null="true"/>
	</class>

		<!-- ************** Class STATUS *************** -->
	<class name="Status" table="Status">
		<id column="dbId" name="dbId" type="long">
			<generator class="native" />
		</id>
		<property column="Value" name="Value" type="string" />
		<property column="StatusTime" name="StatusTime" type="timestamp" />
		<many-to-one name="submission" class="Submission" column="SubmissionID"  not-null="true"/>
	</class>

	<!-- ************** Class USER *************** -->
	<class name="User" table="User">
		<id column="UserKey" name="dbId" type="long">
			<generator class="native" />
		</id>
		<property column="LiferayID" name="LiferayID" type="string" unique="true"/>
		<!--property column="UserID" name="UserID" type="string" unique="true"/>
		<property column="Session" name="Session" type="string" />
		<property column="Authentication" name="Authentication" type="blob" /-->
		<property column="Affiliation" name="Affiliation" type="string" />
		<property column="FirstName" name="FirstName" type="string" />
		<property column="LastName" name="LastName" type="string" />
		<property column="UserEmail" name="UserEmail" type="string" />
		<bag lazy="false" name="applications" table="UserApplication" inverse="true">
			<key column="UserKey" />
			<many-to-many class="Application" column="ApplicationID" />
		</bag>
		<bag lazy="false" name="projects" table="UserProject" inverse="true">
			<key column="UserKey" />
			<many-to-many class="Project" column="ProjectID" />
		</bag>
		<bag lazy="false" name="processings" table="UserProcessing"
			inverse="true">
			<key column="UserKey" />
			<many-to-many class="Processing" column="ProcessingID" />
		</bag>
		<bag lazy="false" name="expacls" inverse="true">
			<key column="UserKey" />
			<one-to-many class="UserProcessing" />
		</bag>
		<bag lazy="false" name="preferences" table="UserPreference" inverse="true">
			<key column="UserKey" />
			<many-to-many class="Preference" column="PrefID" />
		</bag>
	</class>

	<!-- ************** Class UserActivities *************** -->
	<class name="UserActivity" table="UserActivity">
		<id column="ActivityID" name="dbId" type="long">
			<generator class="native" />
		</id>
		<property column="Activity" name="Activity" type="string" />
		<property column="Date" name="Date" type="timestamp" />
		<property column="Status" name="Status" type="string" />
		<many-to-one name="user" class="User" column="UserKey"  not-null="true"/>
	</class>

	<!-- ************** Class UserAuthentication *************** -->
	<class name="UserAuthentication" table="UserAuthentication">
		<id column="AuthenticationID" name="dbId" type="long">
			<generator class="native" />
		</id>
		<property column="userLogin" name="userLogin" type="string" unique="true"/>
		<property column="Authentication" name="Authentication" type="blob" />
		<property column="Session" name="Session" type="string" />
		<many-to-one name="user" class="User" column="UserKey"  not-null="true"/>
		<many-to-one name="resource" class="Resource" column="ResourceID"  not-null="true"/>
	</class>
	<!-- ************** Class INPUT/OUTPUT PORTS *************** -->
	<class name="IOPort" table="IOPort">
		<id column="PortID" name="dbId" type="long">
			<generator class="native" />
		</id>
		<property column="PortNumber" name="PortNumber" type="int" />
		<property column="PortName" name="PortName" type="string" />
		<property column="DisplayName" name="DisplayName" type="string" />
		<property column="IOType" name="IOType" type="string" />
		<property column="DataType" name="DataType" type="string" />
		<property column="DataFormat" name="DataFormat" type="string" />
		<property column="OutputApps" name="OutputApps" type="string" />
		<property column="Visible" name="Visible" type="boolean" />
		<bag lazy="false" name="submissionIOs" inverse="true">
			<key column="PortID" />
			<one-to-many class="SubmissionIO" />
		</bag>
		<!--bag lazy="false" name="status" inverse="true">
			<key column="PortID" />
			<one-to-many class="ProcessingStatus" />
		</bag-->
		<many-to-one name="application" class="Application" column="ApplicationID"  not-null="true"/>
		<many-to-one name="resource" class="Resource" column="ResourceID"  not-null="true"/>
	</class>
	<!-- ************** Class PREFERENCE *************** -->
	<class name="Preference" table="Preference">
		<id column="PrefID" name="dbId" type="long">
			<generator class="native" />
		</id>
		<property column="PrefKey" name="PrefKey" type="string" />
		<property column="PrefValue" name="PrefValue" type="string" length="1024"/>
		<property column="PrefDesc" name="PrefDesc"	type="string" />
		<bag lazy="false" name="users" table="UserPreference">
			<key column="PrefID" />
			<many-to-many class="User" column="UserKey" />
		</bag>
	</class>

	<!-- ************** Class Replica *************** -->
	<class name="Replica" table="Replica">
		<id column="dbId" name="dbId" type="long">
			<generator class="native" />
		</id>
		<property column="ReplicaURI" name="ReplicaURI" type="string" />
		<many-to-one name="dataElement" class="DataElement" column="DataID"  not-null="true"/>
		<many-to-one name="resource" class="Resource" column="ResourceID"  not-null="true"/>
	</class>

	<!-- ************** Class Error *************** -->
	<class name="Error" table="Error">
		<id column="ErrorID" name="dbId" type="long">
			<generator class="native" />
		</id>
		<property column="Code" name="Code" type="int" />
		<property column="Message" name="Message" type="string" />
		<property column="Description" name="Description" type="string" length="1024"/>
		<many-to-one name="submission" class="Submission" column="SubmissionID"  not-null="true"/>
	</class>

</hibernate-mapping>
